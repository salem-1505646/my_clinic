<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clinique Mobile Sync</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root {
            --primary: #0284c7; --doctor: #059669; --bg: #f8fafc;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #1e293b; }
        
        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑŸáÿßÿ™ŸÅ */
        .header { background: #fff; padding: 15px; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 15px; text-align: center; }
        .header h1 { margin: 0; font-size: 20px; color: #0f172a; }

        .tabs { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; margin-bottom: 20px; }
        .tab-btn { padding: 12px 5px; border: 1px solid #e2e8f0; border-radius: 10px; background: white; font-size: 13px; font-weight: 600; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        .tab-btn.active { color: white; border: none; }
        .tab-reception.active { background: var(--primary); }
        .tab-doctor.active { background: var(--doctor); }
        .tab-archive.active { background: #7c3aed; }

        .panel { display: none; }
        .panel.active { display: block; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .grid { display: flex; flex-direction: column; gap: 15px; }
        @media (min-width: 768px) { .grid { display: grid; grid-template-columns: 1fr 1fr; } }

        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow); border: 1px solid #e2e8f0; }
        h3 { margin-top: 0; font-size: 18px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }

        input, textarea { width: 100%; padding: 14px; margin-bottom: 12px; border: 1.5px solid #cbd5e1; border-radius: 10px; font-size: 16px; background: #fdfdfd; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 16px; cursor: pointer; }
        .btn-primary { background: var(--primary); }
        .btn-success { background: var(--doctor); }

        .waiting-list { list-style: none; padding: 0; }
        .waiting-list li { background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .btn-small { width: auto; padding: 8px 15px; font-size: 13px; background: var(--primary); border-radius: 8px; color: white; border: none; font-weight: bold; }

        #print-area { display: none; }
    </style>
</head>
<body>

    <div class="header"><h1>Gestion Clinique</h1></div>

    <div class="tabs">
        <button class="tab-btn tab-reception active" onclick="showTab('reception', this)">üìã R√©ception</button>
        <button class="tab-btn tab-doctor" onclick="secureTab('doctor', this)">ü©∫ M√©decin</button>
        <button class="tab-btn tab-archive" onclick="secureTab('archive', this)">üóÇÔ∏è Archive</button>
        <button class="tab-btn tab-settings" onclick="secureTab('settings', this)">‚öôÔ∏è Config</button>
    </div>

    <div id="reception" class="panel active">
        <div class="grid">
            <div class="card">
                <h3>‚ûï Nouveau Patient</h3>
                <input type="text" id="new-patient-name" placeholder="Nom du patient">
                <input type="number" id="new-patient-age" placeholder="√Çge">
                <button class="btn btn-primary" onclick="addPatient()">Ajouter √† la liste</button>
            </div>
            <div class="card">
                <h3>üë• File d'attente</h3>
                <ul id="reception-list" class="waiting-list"></ul>
            </div>
        </div>
    </div>

    <div id="doctor" class="panel">
        <div class="card">
            <h3 id="doc-p-name">ü©∫ Consultation : (Vide)</h3>
            <textarea id="diagnostic" placeholder="Observations m√©dicales..." rows="4"></textarea>
            <button class="btn btn-success" onclick="finishExam()">‚úÖ Terminer et Archiver</button>
        </div>
    </div>

    <div id="archive" class="panel">
        <div class="card">
            <h3>üîç Historique</h3>
            <input type="text" onkeyup="search(this.value)" placeholder="Chercher un nom...">
            <div id="results"></div>
        </div>
    </div>

    <div id="settings" class="panel">
        <div class="card">
            <h3>‚öôÔ∏è Param√®tres</h3>
            <button class="btn btn-primary" onclick="exportData()">üì• T√©l√©charger Backup</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDBYw9gZW-8uvZo6s3DGJhdWEInyPxvNn8",
            authDomain: "myclinic-c1ae8.firebaseapp.com",
            databaseURL: "https://myclinic-c1ae8-default-rtdb.firebaseio.com",
            projectId: "myclinic-c1ae8",
            storageBucket: "myclinic-c1ae8.firebasestorage.app",
            messagingSenderId: "195782279123",
            appId: "1:195782279123:web:03ee3007c35679cbbf7926"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let data = { waiting: [], archive: [], current: null };

        window.onload = () => {
            db.ref('clinic_main_data').on('value', (snap) => {
                if(snap.exists()) { data = snap.val(); loadUI(); }
            });
        };

        function loadUI() {
            const list = document.getElementById('reception-list');
            list.innerHTML = '';
            (data.waiting || []).forEach(p => {
                list.innerHTML += `<li>
                    <span><b>${p.name}</b> (${p.age})</span>
                    <button class="btn-small" onclick="toDoctor(${p.id})">Envoyer ü©∫</button>
                </li>`;
            });
            document.getElementById('doc-p-name').innerText = data.current ? "ü©∫ Consultation : " + data.current.name : "ü©∫ Consultation : (Vide)";
        }

        function addPatient() {
            const n = document.getElementById('new-patient-name'), a = document.getElementById('new-patient-age');
            if(!n.value) return alert("Nom requis");
            if(!data.waiting) data.waiting = [];
            data.waiting.push({ id: Date.now(), name: n.value, age: a.value });
            save(); n.value = ''; a.value = '';
        }

        // ÿ•ÿµŸÑÿßÿ≠ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑÿ∑ÿ®Ÿäÿ®
        function toDoctor(id) {
            const idx = data.waiting.findIndex(x => x.id === id);
            data.current = data.waiting.splice(idx, 1)[0];
            save();
            // ÿ™ŸÅÿπŸäŸÑ ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ∑ÿ®Ÿäÿ® ÿ®ÿ±ŸÖÿ¨ŸäÿßŸã
            showTab('doctor', document.querySelector('.tab-doctor'));
        }

        function finishExam() {
            if(!data.current) return;
            if(!data.archive) data.archive = [];
            data.archive.push({ ...data.current, diag: document.getElementById('diagnostic').value, date: new Date().toLocaleDateString() });
            data.current = null;
            document.getElementById('diagnostic').value = '';
            save();
            showTab('reception', document.querySelector('.tab-reception'));
        }

        function save() { db.ref('clinic_main_data').set(data); }

        function showTab(id, btn) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
            window.scrollTo(0,0);
        }

        function secureTab(id, btn) {
            if(prompt("Code PIN:") === "1234") showTab(id, btn);
        }

        function search(q) {
            const res = document.getElementById('results');
            res.innerHTML = '';
            (data.archive || []).filter(p => p.name.toLowerCase().includes(q.toLowerCase())).forEach(p => {
                res.innerHTML += `<div class='card' style='margin-bottom:10px'><b>${p.name}</b> (${p.date})<br>${p.diag}</div>`;
            });
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'backup.json';
            a.click();
        }
    </script>
</body>
</html>



